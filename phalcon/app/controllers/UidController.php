<?php

namespace App\Controllers;

use Phalcon\Mvc\Controller;

class UidController extends Controller
{
    public function deAction()
    {
        $uid = [
            'faUhJwYqA+DUKcPvRsMklA==',
            'Cz3aFPaMBh+9XEmxPcKjPw==',
            'zvFeYq9x6EvJvLXJXc560Q==',
            'SbEMCVfg81o4nxAHF85DYA==',
            'bvVE+kHOd308EmxxkiCV3g==',
            'bOMEmcrvCjADUDEHwCF1Ng==',
            'FfJVvy3Vw7VZ4tIgvA3hDQ==',
            'i1IgbonJQmwQeXxUNQuAlg==',
            'zPDcflAMh0hKA0xZYSS58Q==',
            'uDF+jCZ3cNpooR6XU4lDOg==',
            'IBlfIF+ATXdCm9x/qG7Mhw==',
            'y8wSId67/WuWw4Bjs7rxdA==',
            'lK3XzqFkjvlz7fhSQ3k1cg==',
            'A/nZ7Abl9gliTdFP6wcXPg==',
            '9RoPm7FrKjMoOLUADyZ89g==',
            '7aOTxoz5Lw7xLQZMvTY2ag==',
            '8c1MGf9HE7ZdACDtI2P6hg==',
            'znDgHxBDTPTiFrn+OuusLA==',
            '7hg0PFadoWV719nBBXUNhA==',
            'U4HSiyOhQzgRbxYQpMkxcQ==',
            'CSDdgTLNdijZ+2ybXh6XKw==',
            '7hg0PFadoWWQiD55HvWsEw==',
            'mvHLAxdpOreY2WvJdFZRUg==',
            'idqpnUeUC3zXxP1pDFaUZw==',
            '7PTDJlrMldzmXkb5p9aCnA==',
            'rHi8mUzkV+riTkC6h8eXig==',
            'zaSDUy0Zyi3B570/nErZZw==',
            'k9+7YZjwHfhtUgy7AnamPQ==',
            'A/nZ7Abl9gm5uf0k4Pg5Nw==',
            '7hg0PFadoWWKE/cqTJbPqw==',
            'Qi/vsPlQV5rrmCb3Zx5H4w==',
            'Vmshi1l1ibQGrcuvJLJDdw==',
            'JMv/LO6zmUERYXuzc6NPNg==',
            'pDShbv09TVGx8e8TY6ENCw==',
            'jchtx4hNe4H4ukC9/yDHZg==',
            'if1H+8WgC/f+v0xsr60S6w==',
            'FbtYRtFhYGxzXBz77iAB0w==',
            '0VNfmpLVjYLefRjTJENC5Q==',
            'wbyUq9WmSr6anFXl0XzNbA==',
            'Mr0OxNhuOrfzga9oCtlMXA==',
            '8c1MGf9HE7YVjmpG6g4rHA==',
            '1j4eYWJcDexotZVEFK2PQQ==',
            'apnjLdEt2NyNZgQ8+Zm/Og==',
            '+me/njQz1fzLwpJ/ldn/Sw==',
            'wbyUq9WmSr60+oMCrxZzfQ==',
            '/nd6CpQ6tk65uf0k4Pg5Nw==',
            'BlxnL84AD0WhOBym1qIS7g==',
            'v+Xs8ZctjsoOv3rxPdRd9Q==',
            'AmWNNrv5EekZ9Lf65Jpk/A==',
            'gPLya0SACvLKGTgBrRZ2Uw==',
            'DPQS8vFwBU6g3z0rZmxvZQ==',
            'gQaRqGV/iNOW2z/4XIYoIg==',
            'FI9oNIEn5EMfCquGeJ/6fg==',
            'bw39gsZ7biPxZdtq1i6i4A==',
            'jNHoY4979x/rbOY9eHEgsA==',
            'xovklpBXQBTdw36eB7dRZA==',
            'ww5IY2KHuFY7JD/Isl3Bqg==',
            'hw2HN/NCDvnIPKRWnQcLhA==',
            'RuoiWnt/c2w34xhLecFzHw==',
            'qbnlN9aTB8IGWxYdqsxNiQ==',
            'e9YYolY1bD6B0oHyhmQJEg==',
            'zODjuzUu3Gr84BPPmvAShA==',
            'iXV5UnUs46k6k7Agv/Gy0A==',
            'aAywEpwRJYCquRusdM7l0A==',
            'PGeaAmlwnR65uf0k4Pg5Nw==',
            'Ts5us3WXKSd719nBBXUNhA==',
            '+Z4l97zt57pgcCxKC2PDRg==',
            'WmHY3s0mYIxcTc+dmYWYDA==',
            'Rl/hcNSuIJQcSyzzgcAR6w==',
            'X4W6zOV5Ki/bolhXhJ+iVg==',
            'pcCO6ylPl5UMfXg8aKZxvA==',
            'n4E1xGuHzHDTJpRbow7oMA==',
            'BwSHqz76goy72NNSPnBuqQ==',
            '5V+T5Sx4Du9PMLZOYQscow==',
            '3bJO6LesaMb+v0xsr60S6w==',
            'CTSZG2X1O9CiaJZMPJk9hg==',
            'Ftg64Iws6DnMLe1at/Iplw==',
            'TZ9yb994S41fj3dOBCiesQ==',
            '2MMb8n5oIA1Cm9x/qG7Mhw==',
            '1oMHsArqmx79fzZ78rohXg==',
            'vJzZRnJeK91b0zYbkfy+Eg==',
            'X4B/3Jf/YNmBKVW0j/mHHQ==',
            'DR0qqOjSjgKxMvrXrLwLEw==',
            'MheUr/4MWMzUiJ8kuZWgnw==',
            'VUW2iGipdsQi4tcvooV8hw==',
            'q+LhXqBp19dm7nHeZst/YA==',
            'ZSakbEEA07rGAF6+dlCC+Q==',
            '8JSSsoP7ypYLY38KaIEj4w==',
            'zcQ1tPIyj6M17qHaxPJ8fw==',
            'iN7w/6ZXhs4WkhSoZPTi3A==',
            'aptgyncxQgRb0zYbkfy+Eg==',
            'Ua/i+8QGBCNjuvbrS00DCQ==',
            '86B6xfEnFNjTR8Sd0nysSw==',
            'vLDXkQq7pCAjwjGqTnPweg==',
            'R2JsrhCy+5/VZvai75s07w==',
            '9g4mFLq4NDgphbjdyuVcsw==',
            'S8ZDW5DZnM778livfPwpqQ==',
            'BjHhixn9MbHW53u2OSnjfQ==',
            'aBmm0UXsCstjOK1Fv+eseQ==',
            'HVeA9Wohsq0btiUUFbtiRQ==',
            'Naf8v6olQF9O279hE6dlNQ==',
            'i+pUZZLtoboUAhaGLgIowg==',
            'UlUV3ZuXPbosBXQNkp04WQ==',
            'BJ1zCwBWMksP0FuL5znblg==',
            'sFrA3Q1Ux0RZokQPqSTBJQ==',
            '6jrOgN8bFNf0Qe/yQgktiQ==',
            'Fv+TpNzMES42+yN7bTibFA==',
            'SbYVeHbnj+2VFGxqGnr2kw==',
            'Pg76QxLAHx68hgwnyJ3mPw==',
            '/X/CKo2AgVkFtuydWG6ZYA==',
            'hqAgiTdcKKAHSnZL2CyjoQ==',
            'sLPuRanmt9MGrcuvJLJDdw==',
            'AXrLF426p2Bz6M4zO6cMhw==',
            'KFfIMVnUC6Yfy/tbJXx6jQ==',
            'ihe/bJXOlqjfofP+2yw8BQ==',
            'b/o8F6hLfZVjuvbrS00DCQ==',
            'agKSR6jUThnc/IexE0uK4g==',
            '/xsV8UpXomPekAwhMsobng==',
            '1RcWTYwMSaUMfXg8aKZxvA==',
            'cnBK1fLttPv/xVeaIyod7g==',
            'wQ3rQfiunb8G/eiXphif+A==',
            'oTBMasbPkOjC0KdAkdnzBA==',
            'Od9ZrPpEDfGDfyRhFTFD6g==',
            'nwJU40BvPlfuHpLUKG+NBg==',
            'OeQlhmY9DhGQiD55HvWsEw==',
            'xFjPT6U+YTQbnzsJ87ucAA==',
            '9t/XWv45sLvuuy6c+B9HZg==',
            'vzYxxKR67qrIzeHDAlAVQg==',
            'ppJ38T7aiE0O1y4aZJ/wwg==',
            'TZ9yb994S4236AQsIPKGnA==',
            'ZMWCmmWIet15F/kohN2gyA==',
            'aSDUJsJTAoc/4FcvOdKwUw==',
            '/xsV8UpXomOZgPMs/x4I9Q==',
            'abOxLdn06ddg5i4OBiXY7Q==',
            'PHZV9t3GrujpcadLarPTGw==',
            'tB9mmsYyPWj+b2VtRVFTaA==',
            'IpLv9cQoQWrxZdtq1i6i4A==',
            'FVnv1qOEbP/mw4/uX0xipA==',
            '/eNGx9ul40QOv3rxPdRd9Q==',
            'HVeA9Wohsq0LY38KaIEj4w==',
            'P2by9E4hEtVIShgSARcMcQ==',
            '9sGpXCU7TTOLg5htWQ8Dsg==',
            'hPXvlDi3lC8JVmYXiKNtBg==',
        ];

        foreach ($uid as $v) {
            echo $this->decrypt($v, 4), PHP_EOL;
        }
    }

    /**
     * 财富数据表用户信息加密函数
     *
     * @param string $source
     * @param intval $type
     * @return string
     */
    private function encrypt($source, $type = 1)
    {
        $key = $this->_getCryptKey($type);
        // 为了保证加密的结果长度一致，原文统一处理成一定长度
        $source = sprintf('%011d', $source);
        return $this->_encrypt($source, md5($key));
    }

    /**
     * 财富数据表用户信息解密函数
     *
     * @param string $source
     * @param intval $type
     * @return string
     */
    private function decrypt($source, $type = 1)
    {
        $key = $this->_getCryptKey($type);
        return intval($this->_decrypt($source, md5($key)));
    }

    /**
     * 获取加密的KEY
     *
     * @param intval $type
     * @return string
     */
    private function _getCryptKey($type)
    {
        // 1：战旗币，2：金币，3：金豆，4：子弹，5：火力值
        $keyMap = [
            1 => '$%^*&^%^%^=',
            2 => '&^&%&*NEf2f',
            3 => '3m441*(N()^',
            4 => '6u11etva1ue',
            5 => '$^f!rep0wer',
        ];
        if (!isset($keyMap[$type])) {
            return '!#%&()*^$@';
        }
        return $keyMap[$type];
    }

    /**
     * 使用TripleDes加密源数据
     *
     * @param string $source        源数据
     * @param string $key            密钥
     * @param string $iv           加解密向量
     * @return string                密文
     */
    private function _encrypt($source, $key, $iv = '')
    {
        // 结果为24位
        $key = base64_decode($key);
        // 结果为8位
        $iv = base64_decode($iv);
        $source = $this->_addPKCS7Padding($source);
        $td = mcrypt_module_open(MCRYPT_3DES, '', MCRYPT_MODE_ECB, '');
        @mcrypt_generic_init($td, $key, $iv);
        $result = mcrypt_generic($td, $source);
        mcrypt_generic_deinit($td);
        mcrypt_module_close($td);
        return base64_encode($result);
    }

    /**
     * 使用TripleDes解密密文
     *
     * @param string $ciphertext    密文
     * @param string $key            密钥
     * @param string $iv            加解密向量
     * @return string                解密后的原文
     */
    private function _decrypt($ciphertext, $key, $iv = '')
    {
        // 结果为24位
        $key = base64_decode($key);
        //结果为8位
        $iv = base64_decode($iv);
        $ciphertext = base64_decode($ciphertext);
        $td = mcrypt_module_open(MCRYPT_3DES, '', MCRYPT_MODE_ECB, '');
        @mcrypt_generic_init($td, $key, $iv);
        $result = mdecrypt_generic($td, $ciphertext);
        mcrypt_generic_deinit($td);
        mcrypt_module_close($td);
        return $this->_stripPKSC7Padding($result);
    }

    /**
     * 为字符串添加PKCS7 Padding
     *
     * @param string $source     源字符串
     * @return string
     */
    private function _addPKCS7Padding($source)
    {
        $block = mcrypt_get_block_size('tripledes', MCRYPT_MODE_ECB);
        $pad = $block - (strlen($source) % $block);
        if ($pad <= $block) {
            $char = chr($pad);
            $source .= str_repeat($char, $pad);
        }
        return $source;
    }

    /**
     * 去除字符串末尾的PKCS7 Padding
     *
     * @param string $source    带有padding字符的字符串
     * @return string
     */
    private function _stripPKSC7Padding($source)
    {
        $block = mcrypt_get_block_size('tripledes', MCRYPT_MODE_ECB);
        $char = substr($source, -1, 1);
        $num = ord($char);
        if ($num > 8) {
            return $source;
        }
        $len = strlen($source);
        for ($i = $len - 1; $i >= $len - $num; $i--) {
            if (ord(substr($source, $i, 1)) != $num) {
                return $source;
            }
        }
        return substr($source, 0, -$num);
    }
}
